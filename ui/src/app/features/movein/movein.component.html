<div
  *ngIf="showModal"
  class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
>
  <div
    class="bg-white rounded-xl shadow-lg w-full max-w-2xl p-6 relative animate-fadeIn"
  >
    <!-- Close button -->
    <button
      (click)="closeModal()"
      class="absolute top-3 right-3 text-gray-600 hover:text-black text-xl"
    >
      ‚úñ
    </button>

    <!-- Modal Title -->
    <h3 class="text-lg font-semibold mb-4">
      {{ isEditing ? '‚úèÔ∏è Update Move-In' : '‚ûï Add New Move-In' }}
    </h3>

    <!-- Move-In Form -->
    <form
      (ngSubmit)="isEditing ? updateMoveIn() : addMoveIn()"
      #moveInForm="ngForm"
      class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"
    >
      <div>
        <label class="font-semibold block mb-1">Full Name</label>
        <input
          type="text"
          [(ngModel)]="moveIn.FullName"
          name="FullName"
          required
          class="border rounded-lg px-3 py-2 w-full"
        />
      </div>

      <div>
        <label class="font-semibold block mb-1">Email</label>
        <input
          type="email"
          [(ngModel)]="moveIn.Email"
          name="Email"
          required
          class="border rounded-lg px-3 py-2 w-full"
        />
      </div>

      <div>
        <label class="font-semibold block mb-1">Mobile Number</label>
        <input
          type="tel"
          [(ngModel)]="moveIn.Mobile"
          name="Mobile"
          required
          class="border rounded-lg px-3 py-2 w-full"
        />
      </div>

      <div>
        <label class="font-semibold block mb-1">Move-In Date</label>
        <input
          type="date"
          [(ngModel)]="moveIn.MoveInDate"
          name="MoveInDate"
          required
          class="border rounded-lg px-3 py-2 w-full"
        />
      </div>

      <div>
        <label class="font-semibold block mb-1">Building</label>
        <select
          [(ngModel)]="moveIn.BuildingId"
          name="BuildingId"
          (change)="onFormBuildingChange()"
          required
          class="border rounded-lg px-3 py-2 w-full"
        >
          <option value="">Select Building</option>
          <option *ngFor="let b of buildings" [value]="b.Id">
            {{ b.BuildingNumber }}
          </option>
        </select>
      </div>

      <div>
        <label class="font-semibold block mb-1">Unit</label>
        <select
          [(ngModel)]="moveIn.UnitId"
          name="UnitId"
          required
          class="border rounded-lg px-3 py-2 w-full"
        >
          <option value="">Select Unit</option>
          <option *ngFor="let u of units" [value]="u.Id">
            {{ u.UnitNumber }}
          </option>
        </select>
      </div>

      <div class="col-span-full text-right">
        <button
          type="submit"
          class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
        >
          {{ isEditing ? 'üíæ Update Move-In' : '‚ûï Add Move-In' }}
        </button>
      </div>
    </form>
  </div>
</div>

<div class="p-6 bg-white rounded-xl shadow-md">
  <!-- Header -->
  <div class="mb-4 flex justify-between items-center">
    <h2 class="text-2xl font-bold text-gray-700">üè† Move-In Records</h2>
  </div>

  <!-- Filters & Search -->
  <div class="flex flex-wrap gap-4 mb-5">
    <!-- Building Filter -->
    <div>
      <label class="block text-sm font-semibold mb-1">Building</label>
      <input placeholder="Bldg. #" value="303"
           class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
    </div>

    <!-- Unit Filter -->
    <div>
      <label class="block text-sm font-semibold mb-1">Unit</label>
      <input
        type="text"
        class="border rounded-lg px-3 py-2 w-40"
        [(ngModel)]="searchText"
        (ngModelChange)="onSearchChange()"
        placeholder="Enter unit #"
      />
    </div>
  </div>

  <!-- Move-In Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 text-sm">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="py-2 px-4 border-b text-left">Bldg. #</th>
          <th class="py-2 px-4 border-b text-left">Unit #</th>
          <th class="py-2 px-4 border-b text-left">Full Name</th>
          <th class="py-2 px-4 border-b text-left">Move-In Date</th>
          <th class="py-2 px-4 border-b text-left">Mobile Number</th>
          <th class="py-2 px-4 border-b text-left">Email</th>
          <th class="py-2 px-4 border-b text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let movein of filteredMoveIns()"
          class="border-b hover:bg-gray-50"
        >
          <td class="py-2 px-4">{{ movein.unit?.building.BuildingNumber || '-' }}</td>
          <td class="py-2 px-4">{{ movein.unit?.UnitNumber || '-' }}</td>
          <td class="py-2 px-4 font-medium">{{ movein.FullName }}</td>
          <td class="py-2 px-4">{{ movein.MoveInDate | date: 'yyyy-MM-dd' }}</td>
          <td class="py-2 px-4">{{ movein.Mobile }}</td>
          <td class="py-2 px-4">{{ movein.Email }}</td>
          <td class="py-2 px-4 text-center">
            <button
              class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition"
              (click)="editMoveIn(movein)"
            >
              ‚úèÔ∏è Update
            </button>
          </td>
        </tr>

        <tr *ngIf="filteredMoveIns().length === 0">
        <tr *ngIf="filteredMoveIns().length === 0">
          <td colspan="7" class="text-center py-3 text-gray-500">
            No records found.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Pagination Controls -->
<div class="flex items-center justify-between mt-4">
  <div>
    Showing page {{ page }} of {{ totalPages }}
    ({{ total }} records)
  </div>
  <div class="flex items-center gap-2">
    <button (click)="onPageChange(page - 1)" [disabled]="page === 1" class="px-3 py-1 rounded border bg-gray-100">Prev</button>
    <span>Page {{ page }}</span>
    <button (click)="onPageChange(page + 1)" [disabled]="page >= totalPages" class="px-3 py-1 rounded border bg-gray-100">Next</button>
    <select [(ngModel)]="pageSize" (change)="onPageSizeChange(pageSize)" class="ml-2 border rounded px-2 py-1">
      <option [value]="5">5</option>
      <option [value]="10">10</option>
      <option [value]="20">20</option>
      <option [value]="50">50</option>
    </select>
    <span>per page</span>
  </div>
</div>