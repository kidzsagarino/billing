<div class="p-6 bg-gray-50 min-h-screen">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold text-gray-800">Payments</h1>
    <button
      (click)="openModal()"
      class="bg-blue-600 text-white font-semibold rounded-md px-5 py-2 shadow-sm hover:shadow-md hover:bg-blue-700 transition"
    >
      + Add Payment
    </button>
  </div>
  <!-- MODAL OVERLAY -->
  <div 
    *ngIf="showModal"
    class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4"
  >
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
      <h2 class="text-xl font-bold mb-4">{{ isEditing ? 'Update Payment' : 'Add Payment' }}</h2>

      <form (ngSubmit)="isEditing ? updatePayment() : submitPayment()" #paymentForm="ngForm" class="space-y-4">
        <div class="grid grid-cols-2 gap-2">
          <div class="relative">
            <select 
              name="billingYear"
              [(ngModel)]="payment.BillingYear"
              #yearControl="ngModel" class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
              required
            >
              <option value="" disabled selected></option> 
              <option *ngFor="let y of years" [value]="y">{{ y }}</option>
            </select>
            <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">Year</label>

            <div *ngIf="yearControl.invalid && yearControl.touched" class="text-red-500 text-xs mt-1"> 
              <span *ngIf="yearControl.errors?.['required']">
                Year is required.
              </span>
            </div>
          </div>

          <div class="relative">
            <select 
              name="billingMonth"
              [(ngModel)]="payment.BillingMonth"
              #monthControl="ngModel" class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
              required
            >
              <option value="" disabled selected></option>
              <option *ngFor="let m of months" [value]="m">{{ m }}</option>
            </select>
            <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">Month</label>
            
            <div *ngIf="monthControl.invalid && monthControl.touched" class="text-red-500 text-xs mt-1"> 
              <span *ngIf="monthControl.errors?.['required']">
                Month is required.
              </span>
            </div>
          </div>
        </div>

        <div class="relative">
          <input 
            type="text"
            name="unit"
            [(ngModel)]="payment.UnitNumber"
            (ngModelChange)="searchMoveinNameInUnit()"
            required
            #unitControl="ngModel" class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
          <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">Unit Number</label>
          
          <div *ngIf="unitControl.invalid && unitControl.touched" class="text-red-500 text-xs mt-1"> 
            <span *ngIf="unitControl.errors?.['required']">
              Unit Number is required.
            </span>
          </div>
        </div>

        <div class="relative">
          <input 
            type="text"
            name="movein"
            [(ngModel)]="moveInName"
            readonly
            class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-gray-100 cursor-not-allowed"
          />
          <label class="absolute left-3 top-2 text-gray-400 text-sm transition-all">Movein Name</label>
        </div>

        <div class="relative">
          <input 
            type="date"
            name="date"
            [(ngModel)]="payment.PaymentDate"
            required
            #dateControl="ngModel" class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
          <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">Payment Date</label>

          <div *ngIf="dateControl.invalid && dateControl.touched" class="text-red-500 text-xs mt-1"> 
            <span *ngIf="dateControl.errors?.['required']">
              Payment Date is required.
            </span>
          </div>
        </div>

        <div class="relative">
          <input 
            type="number"
            name="amount"
            [(ngModel)]="payment.Amount"
            required
            #amountControl="ngModel" class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
          <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">Amount</label>

          <div *ngIf="amountControl.invalid && amountControl.touched" class="text-red-500 text-xs mt-1"> 
            <span *ngIf="amountControl.errors?.['required']">
              Amount is required.
            </span>
          </div>
        </div>

        <div class="relative">
          <input 
            type="text"
            name="arNumber"
            [(ngModel)]="payment.ARNumber"
            class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
          <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">AR #</label>
          </div>

        <div class="relative">
          <select 
            name="paymentType"
            [(ngModel)]="payment.PaymentType"
            #typeControl="ngModel"
            class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
            required
          >
            <option [ngValue]="null" disabled selected>Select Payment Type</option> 
            <option *ngFor="let type of paymentTypes" [value]="type.value">{{ type.label }}</option>
          </select>
          <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">Payment Type</label>

          <div *ngIf="typeControl.invalid && typeControl.touched" class="text-red-500 text-xs mt-1"> 
            <span *ngIf="typeControl.errors?.['required']">
              Payment Type is required.
            </span>
          </div>
        </div>

        <div class="relative">
          <input 
            type="text"
            name="refNumber"
            [(ngModel)]="payment.RefNumber"
            class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
          <label class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:text-blue-500 peer-focus:text-sm transition-all">Ref #</label>
          </div>

        <div class="flex justify-end gap-2 pt-4">
          <button type="button" (click)="closeModal()" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400 transition">Cancel</button>
          
          <button 
            type="submit" 
            [disabled]="paymentForm.invalid" class="px-4 py-2 text-white rounded-lg shadow transition"
            [class.bg-blue-600]="!paymentForm.invalid"
            [class.bg-gray-400]="paymentForm.invalid"
            [class.cursor-not-allowed]="paymentForm.invalid"
          >
            {{ isEditing ? 'Update': 'Save' }}
          </button>
        </div>
    </form>
    </div>
  </div>

  <div class="flex flex-wrap gap-4">
    <div class="flex flex-wrap gap-4">

      <!-- Building -->
      <div class="relative flex-1 min-w-[200px]">
        <input
          type="text"
          placeholder=" "
          value="303"
          class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
        />
        <label
          class="absolute left-3 top-2 text-gray-400 text-sm peer-placeholder-shown:top-5 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
        >
          Building
        </label>
      </div>

      <!-- Unit -->
      <div class="relative flex-1 min-w-[200px]">
        <input
          type="text"
          [(ngModel)]="searchUnit"
          (ngModelChange)="onSearchChange()"
          placeholder=" "
          class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
        />
        <label
          class="absolute left-3 top-2 text-gray-400 text-sm peer-placeholder-shown:top-5 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
        >
          Unit
        </label>
      </div>

      <!-- Year Dropdown -->
      <div class="relative flex-1 min-w-[200px]">
        <select
          [(ngModel)]="selectedYear"
          (ngModelChange)="loadPayments()"
          class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400 appearance-none"
        >
          <option value="" disabled selected></option>
          <option *ngFor="let y of years" [value]="y">{{ y }}</option>
        </select>
        <label
          class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
        >
          Year
        </label>
      </div>

      <!-- Month Dropdown -->
      <div class="relative flex-1 min-w-[200px]">
        <select
          [(ngModel)]="selectedMonth"
          (ngModelChange)="loadPayments()"
          class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400 appearance-none"
        >
          <option value="" disabled selected></option>
          <option *ngFor="let m of months" [value]="m">{{ m }}</option>
        </select>
        <label
          class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
        >
          Month
        </label>
      </div>
    </div>
  </div>
  <!-- PAYMENTS TABLE -->
  <div class="">
    <!-- TABLE WRAPPER -->
    <div class="overflow-x-auto rounded-lg shadow">
      <table class="min-w-full bg-white border border-gray-200">
        <thead>
          <tr class="bg-gray-100 text-left text-gray-700">
            <th class="py-2 px-4 border-b">Bldng</th>
            <th class="py-2 px-4 border-b">Unit</th>
            <th class="py-2 px-4 border-b">Billing Month</th>
            <th class="py-2 px-4 border-b">Owner</th>
            <th class="py-2 px-4 border-b">Date</th>
            <th class="py-2 px-4 border-b">Amount</th>
            <th class="py-2 px-4 border-b">AR #</th>
            <th class="py-2 px-4 border-b">Payment Type</th>
            <th class="py-2 px-4 border-b">Ref #</th>
            <th class="py-2 px-4 border-b">Actions</th>
            
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="payments.length === 0">
              <td colspan="10" 
                  class="py-4 px-4 text-center text-gray-500 border-b">
                No payments found.
            </td>
          </tr>
          <tr class="hover:bg-gray-50 transition" *ngFor="let payment of payments">
            <td class="py-2 px-4 border-b">303</td>
            <td class="py-2 px-4 border-b">{{ payment.unit.UnitNumber }}</td>
            <td class="py-2 px-4 border-b">{{ payment.BillingMonth }}</td>
            <td class="py-2 px-4 border-b">{{ payment.unit.moveins[0].FullName }}</td>
            <td class="py-2 px-4 border-b">{{ payment.PaymentDate | date: 'yyyy-MM-dd' }}</td>
            <td class="py-2 px-4 border-b">₱{{ payment.Amount }}</td>
            <td class="py-2 px-4 border-b">{{ payment.ARNumber }}</td>
            <td class="py-2 px-4 border-b">{{ payment.PaymentType}}</td>
            <td class="py-2 px-4 border-b">{{ payment.RefNumber }}</td>
            <td class="py-2 px-4 text-center">
              <button
                class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition"
                (click)="editPayment(payment)"
              >
              ✏️ Update
            </button>
          </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
