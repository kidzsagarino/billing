<div class="p-6 bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold text-gray-800">Water Readings</h1>
    <!-- Load Button -->
    <div class="flex items-center justify-center">
      <button
        class="bg-blue-600 text-white font-semibold rounded-md px-5 py-2 shadow-sm hover:shadow-md hover:bg-blue-700 transition"
        (click)="loadReadingForBillingMonth()"
      >
        Load
      </button>
    </div>
  </div>

  <!-- Filters -->
<!-- Filters with Floating Labels -->
<div class="bg-white rounded-lg grid grid-cols-4 gap-5 mb-3 w-100">

  <!-- Building -->
  <div class="relative">
    <input 
      type="text"
      placeholder=" "
      value="303"
      class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
    />
    <label
      class="absolute left-3 top-2 text-gray-400 text-sm peer-placeholder-shown:top-5 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
    >
      Building
    </label>
  </div>

  <!-- Unit -->
  <div class="relative">
    <input
      type="text"
      [(ngModel)]="searchUnit"
      (ngModelChange)="searchByUnitNumber()"
      placeholder=" "
      class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
    />
    <label
      class="absolute left-3 top-2 text-gray-400 text-sm peer-placeholder-shown:top-5 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
    >
      Unit
    </label>
  </div>

  <!-- Year Dropdown -->
  <div class="relative">
    <select
      [(ngModel)]="selectedYear"
      (ngModelChange)="searchByBillingMonth()"
      class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400 appearance-none"
    >
      <option value="" disabled selected></option>
      <option *ngFor="let y of years" [value]="y">{{ y }}</option>
    </select>
    <label
      class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
    >
      Year
    </label>
  </div>

  <!-- Month Dropdown -->
  <div class="relative">
    <select
      [(ngModel)]="selectedMonth"
      (ngModelChange)="searchByBillingMonth()"
      class="peer block w-full border border-gray-300 rounded-md px-3 pt-5 pb-2 focus:outline-none focus:ring-2 focus:ring-blue-400 appearance-none"
    >
      <option value="" disabled selected></option>
      <option *ngFor="let m of months" [value]="m">{{ m }}</option>
    </select>
    <label
      class="absolute left-3 top-2 text-gray-400 text-sm peer-focus:top-2 peer-focus:text-blue-500 peer-focus:text-sm transition-all"
    >
      Month
    </label>
  </div>
</div>
  <!-- Table -->
  <div class="overflow-x-auto bg-gray-50">
    <table class="min-w-full table-auto border-collapse">
      <thead class="bg-gray-100">
        <tr class="bg-gray-100 text-left text-gray-700">
          <th class="p-3 border-b">Building #</th>
          <th class="p-3 border-b">Unit #</th>
          <th class="p-3 border-b">Month</th> 
          <th class="p-3 border-b text-right">Reading</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let item of readings; let i = index"
          class="hover:bg-gray-50 transition"
        >
          <td class="p-3 border-b">{{ item.unit.building.BuildingNumber }}</td>
          <td class="p-3 border-b">{{ item.unit.UnitNumber }}</td>
          <td class="p-3 border-b">{{ item.BillingMonth }}</td>
         <td class="p-3 border-b text-right" (click)="startEdit(i, item.Consumption)" #readingInput>
            <ng-container *ngIf="!isEditing(i); else editInput">
              {{ item.Consumption }}
            </ng-container>
            <ng-template #editInput>
              <input
                type="number"
                class="border rounded px-2 py-1 w-24 text-right"
                [(ngModel)]="editValue"
                (blur)="finishEdit(i)"
                (keydown)="onKeydown($event, i)"
                (focus)="selectText($event)" 
              />
            </ng-template>
          </td>
          
        </tr>
        <tr *ngIf="readings.length === 0">
          <td colspan="7" class="text-center py-3 text-gray-500">No records found.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <!-- <div class="flex justify-center gap-2 mt-4">
    <button class="px-3 py-1 border rounded" [disabled]="page === 1" (click)="goToPage(page - 1)">Prev</button>
    <span class="px-3 py-1">Page {{ page }} of {{ totalPages }}</span>
    <button class="px-3 py-1 border rounded" [disabled]="page === totalPages" (click)="goToPage(page + 1)">Next</button>
  </div> -->

 <div
    *ngIf="showModal"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
  >
    <div
      class="bg-white w-full max-w-lg rounded-lg shadow-lg p-6 relative animate-fadeIn"
    >
      <!-- Close Button -->
      <button
        (click)="closeModal()"
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
      >
        ✕
      </button>

      <h2 class="text-xl font-semibold text-gray-700 mb-4">
        Add Water Reading
      </h2>

      <form (ngSubmit)="saveReading()" class="grid grid-cols-1 md:grid-cols-2 gap-4">

         <!-- Building Number -->
        <div>
            <input type="number" placeholder="Bldg. #"
                [(ngModel)]="reading.buildingNumber" name="buildingNumber"
                class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>

        <!-- Unit Number -->
        <div>
            <input type="number" placeholder="Unit #"
                [(ngModel)]="reading.unitNumber" name="unitNumber"
                class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>
         <!-- Billing Month -->
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">Reading date</label>
          <input
            type="date"
            [(ngModel)]="reading.readingDate"
            name="billingMonth"
            class="border rounded-md px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>
        <!-- Previous Reading -->
        <div>
          <label class="block text-sm font-semibold mb-1">Previous Reading</label>
          <input
            type="number"
            step="0.01"
            [(ngModel)]="reading.previousReading"
            name="previousReading"
            class="border rounded-md px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>

        <!-- Current Reading -->
        <div>
          <label class="block text-sm font-semibold mb-1">Current Reading</label>
          <input
            type="number"
            step="0.01"
            [(ngModel)]="reading.currentReading"
            name="currentReading"
            (input)="computeConsumption()"
            class="border rounded-md px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>

        <!-- Consumption -->
        <div>
          <label class="block text-sm font-semibold mb-1">Consumption (m³)</label>
          <input
            type="text"
            [value]="reading.consumption"
            readonly
            class="border rounded-md px-3 py-2 w-full bg-gray-100 text-gray-700"
          />
        </div>

        <!-- Rate -->
        <div>
          <label class="block text-sm font-semibold mb-1">Rate (₱/m³)</label>
          <input
            type="number"
            step="0.01"
            [(ngModel)]="reading.ratePerCubic"
            name="ratePerCubic"
            (input)="computeTotal()"
            class="border rounded-md px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>

        <!-- Total -->
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">Total (₱)</label>
          <input
            type="text"
            [value]="reading.totalAmount"
            readonly
            class="border rounded-md px-3 py-2 w-full bg-gray-100 text-gray-700"
          />
        </div>

        <!-- Action Buttons -->
        <div class="md:col-span-2 flex justify-end mt-3 gap-3">
          <button
            type="button"
            (click)="closeModal()"
            class="border border-gray-400 text-gray-600 rounded-md px-5 py-2 hover:bg-gray-100 transition"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="bg-green-600 text-white font-semibold rounded-md px-6 py-2 shadow-sm hover:shadow-md hover:bg-green-700 transition"
          >
            Save
          </button>
        </div>
      </form>
    </div>
</div>